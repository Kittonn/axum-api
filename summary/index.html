<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Test Summary</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container {
            height: 300px;
            width: 100%;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Load Test Results Summary</h1>
            <p id="test-date"></p>
        </div>

        <div class="summary-stats">
            <div class="stat-box">
                <div class="metric-label">Total Requests</div>
                <div class="metric-value" id="total-reqs">-</div>
            </div>
            <div class="stat-box">
                <div class="metric-label">RPS</div>
                <div class="metric-value" id="rps">-</div>
            </div>
            <div class="stat-box">
                <div class="metric-label">VUs Max</div>
                <div class="metric-value" id="vus-max">-</div>
            </div>
            <div class="stat-box">
                <div class="metric-label">Failures</div>
                <div class="metric-value" id="failures">-</div>
            </div>
            <div class="stat-box">
                <div class="metric-label">Avg Duration</div>
                <div class="metric-value" id="avg-duration">-</div>
            </div>
        </div>

        <div class="card-grid">
            <div class="card">
                <h3>Response Time Distribution (ms)</h3>
                <div id="durationChart" class="chart-container"></div>
            </div>
            <div class="card">
                <h3>Success Rate</h3>
                <div id="gaugeChart" class="chart-container"></div>
            </div>
            <div class="card">
                <h3>Request Timing Breakdown (ms)</h3>
                <div id="timingChart" class="chart-container"></div>
            </div>
             <div class="card">
                <h3>Iterations</h3>
                <div id="iterationChart" class="chart-container"></div>
            </div>
        </div>
    </div>

    <script>
        const data = {
            "root_group": {
                "name": "",
                "path": "",
                "id": "d41d8cd98f00b204e9800998ecf8427e",
                "groups": {},
                "checks": {
                        "status is 200": {
                            "passes": 1616457,
                            "fails": 0,
                            "name": "status is 200",
                            "path": "::status is 200",
                            "id": "6210a8cd14cd70477eba5c5e4cb3fb5f"
                        }
                    }
            },
            "metrics": {
                "vus": {
                    "value": 2151,
                    "min": 2151,
                    "max": 5000
                },
                "http_req_duration": {
                    "max": 7826.278,
                    "p(90)": 3059.6584,
                    "p(95)": 3541.7934,
                    "p(99)": 4695.061,
                    "avg": 1859.359883645439,
                    "min": 1020.308,
                    "med": 1536.227,
                    "thresholds": {
                        "p(95)<2000": true
                    }
                },
                "http_req_connecting": {
                    "p(90)": 0,
                    "p(95)": 0,
                    "p(99)": 0,
                    "avg": 0.005183534111949749,
                    "min": 0,
                    "med": 0,
                    "max": 62.518
                },
                "http_req_sending": {
                    "med": 0.004,
                    "max": 4.402,
                    "p(90)": 0.019,
                    "p(95)": 0.028,
                    "p(99)": 0.049,
                    "avg": 0.00826806961158749,
                    "min": 0.001
                },
                "http_reqs": {
                    "count": 1616457,
                    "rate": 2682.0167209682622
                },
                "http_req_failed": {
                    "passes": 0,
                    "fails": 1616457,
                    "thresholds": {
                        "rate<0.01": false
                    },
                    "value": 0
                },
                "http_req_blocked": {
                    "max": 62.528,
                    "p(90)": 0.002,
                    "p(95)": 0.002,
                    "p(99)": 0.005,
                    "avg": 0.006399282505067616,
                    "min": 0,
                    "med": 0.001
                },
                "http_req_waiting": {
                    "avg": 1859.3370803430914,
                    "min": 1020.293,
                    "med": 1536.206,
                    "max": 7826.23,
                    "p(90)": 3059.6428,
                    "p(95)": 3541.768199999999,
                    "p(99)": 4695.00544
                },
                "data_sent": {
                    "count": 345921798,
                    "rate": 573951.5782872081
                },
                "data_received": {
                    "count": 900366549,
                    "rate": 1493883.313579322
                },
                "checks": {
                    "passes": 1616457,
                    "fails": 0,
                    "value": 1
                },
                "vus_max": {
                    "value": 5000,
                    "min": 4343,
                    "max": 5000
                },
                "iteration_duration": {
                    "p(90)": 3059.705225,
                    "p(95)": 3541.8098996,
                    "p(99)": 4695.21228852,
                    "avg": 1859.3985642934517,
                    "min": 1020.357541,
                    "med": 1536.259125,
                    "max": 7826.426708
                },
                "iterations": {
                    "count": 1616457,
                    "rate": 2682.0167209682622
                },
                "http_req_duration{expected_response:true}": {
                    "p(95)": 3541.7934,
                    "p(99)": 4695.061,
                    "avg": 1859.359883645439,
                    "min": 1020.308,
                    "med": 1536.227,
                    "max": 7826.278,
                    "p(90)": 3059.6584
                },
                "http_req_receiving": {
                    "p(90)": 0.028,
                    "p(95)": 0.036,
                    "p(99)": 0.056,
                    "avg": 0.014535232919886907,
                    "min": 0.004,
                    "med": 0.01,
                    "max": 9.612
                },
                "http_req_tls_handshaking": {
                    "avg": 0,
                    "min": 0,
                    "med": 0,
                    "max": 0,
                    "p(90)": 0,
                    "p(95)": 0,
                    "p(99)": 0
                },
                "dropped_iterations": {
                    "rate": 22205.903895875028,
                    "count": 13383544
                }
            }
        };

        // Populate Summary Stats
        document.getElementById('total-reqs').textContent = data.metrics.http_reqs.count.toLocaleString();
        document.getElementById('rps').textContent = data.metrics.http_reqs.rate.toFixed(2);
        document.getElementById('vus-max').textContent = data.metrics.vus_max.value;
        const totalChecks = data.metrics.checks.passes + data.metrics.checks.fails;
        document.getElementById('failures').textContent = data.metrics.checks.fails.toLocaleString();
        document.getElementById('avg-duration').textContent = data.metrics.http_req_duration.avg.toFixed(2) + ' ms';


        // 1. Duration Distribution Chart
        const durationChart = echarts.init(document.getElementById('durationChart'));
        const durationOption = {
            tooltip: { trigger: 'axis' },
            xAxis: { 
                type: 'category', 
                data: ['Min', 'Median', 'Avg', 'p90', 'p95', 'p99', 'Max'] 
            },
            yAxis: { 
                type: 'value',
                name: 'Time (ms)'
            },
            series: [{
                data: [
                    data.metrics.http_req_duration.min,
                    data.metrics.http_req_duration.med,
                    data.metrics.http_req_duration.avg,
                    data.metrics.http_req_duration['p(90)'],
                    data.metrics.http_req_duration['p(95)'],
                    data.metrics.http_req_duration['p(99)'],
                    data.metrics.http_req_duration.max
                ],
                type: 'bar',
                itemStyle: { color: '#5470c6' },
                label: {
                    show: true,
                    position: 'top',
                    formatter: '{c}'
                }
            }]
        };
        durationChart.setOption(durationOption);

        // 2. Success Rate Gauge
        const gaugeChart = echarts.init(document.getElementById('gaugeChart'));
        const passRate = totalChecks > 0 ? (data.metrics.checks.passes / totalChecks) * 100 : 0;
        const gaugeOption = {
            series: [{
                type: 'gauge',
                startAngle: 180,
                endAngle: 0,
                min: 0,
                max: 100,
                splitNumber: 5,
                progress: {
                    show: true,
                    width: 18
                },
                pointer: {
                    show: false
                },
                axisLine: {
                    lineStyle: {
                        width: 18
                    }
                },
                axisTick: {
                    show: false
                },
                splitLine: {
                    length: 15,
                    lineStyle: {
                        width: 2,
                        color: '#999'
                    }
                },
                axisLabel: {
                    distance: 25,
                    color: '#999',
                    fontSize: 20
                },
                anchor: {
                    show: true,
                    showAbove: true,
                    size: 25,
                    itemStyle: {
                        borderWidth: 10
                    }
                },
                title: {
                    show: false
                },
                detail: {
                    valueAnimation: true,
                    fontSize: 40,
                    offsetCenter: [0, '30%'],
                    formatter: '{value}%'
                },
                data: [{ value: passRate.toFixed(2) }]
            }]
        };
        gaugeChart.setOption(gaugeOption);

        // 3. Breakdown of Timing
        const timingChart = echarts.init(document.getElementById('timingChart'));
        const timingOption = {
            tooltip: { trigger: 'item' },
            legend: { top: '5%', left: 'center' },
            series: [{
                name: 'Time Breakdown',
                type: 'pie',
                radius: ['40%', '70%'],
                avoidLabelOverlap: false,
                itemStyle: {
                    borderRadius: 10,
                    borderColor: '#fff',
                    borderWidth: 2
                },
                label: {
                    show: false,
                    position: 'center'
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 20,
                        fontWeight: 'bold'
                    }
                },
                labelLine: { show: false },
                data: [
                    { value: data.metrics.http_req_connecting.avg, name: 'Connecting' },
                    { value: data.metrics.http_req_sending.avg, name: 'Sending' },
                    { value: data.metrics.http_req_waiting.avg, name: 'Waiting (TTFB)' },
                    { value: data.metrics.http_req_receiving.avg, name: 'Receiving' },
                    { value: data.metrics.http_req_blocked.avg, name: 'Blocked' }
                ]
            }]
        };
        timingChart.setOption(timingOption);

         // 4. Iterations vs Dropped
         const iterationChart = echarts.init(document.getElementById('iterationChart'));
         const iterationOption = {
            tooltip: { trigger: 'axis' },
             xAxis: { type: 'category', data: ['Iterations', 'Dropped'] },
             yAxis: { type: 'value' },
             series: [{
                 data: [
                     {value: data.metrics.iterations.count, itemStyle: {color: '#91cc75'}},
                     {value: data.metrics.dropped_iterations.count, itemStyle: {color: '#ee6666'}}
                 ],
                 type: 'bar',
                   label: {
                    show: true,
                    position: 'top'
                }
             }]
         };
         iterationChart.setOption(iterationOption);

        // Resize charts on window resize
        window.addEventListener('resize', () => {
            durationChart.resize();
            gaugeChart.resize();
            timingChart.resize();
            iterationChart.resize();
        });
    </script>
</body>
</html>
